{{/* google.email.tmpl - contains both html and subject templates */}}

{{ define "google.email.html" }}
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <style>
    body { font-family: 'Roboto', 'Google Sans', Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 20px auto; border: 1px solid #dfe1e5; border-radius: 8px; overflow: hidden; }
    .header { padding: 20px; text-align: center; }
    .header.firing { background-color: #d93025; color: white; }
    .header.resolved { background-color: #1e8e3e; color: white; }
    .header h1 { margin: 0; font-size: 24px; font-weight: 500; }
    .content { padding: 24px; color: #3c4043; line-height: 1.5; }
    .content h2 { font-size: 18px; color: #202124; border-bottom: 1px solid #dfe1e5; padding-bottom: 8px; margin-top: 0; }
    .alert-item { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px dashed #dfe1e5; }
    .alert-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .label { background-color: #f1f3f4; border-radius: 4px; padding: 2px 8px; font-size: 12px; margin-right: 8px; display: inline-block; white-space: nowrap; }
    .label.severity-warning { background-color: #feefc3; color: #785300; }
    .label.severity-critical { background-color: #fce8e6; color: #b71c1c; }
    .annotation { margin-top: 8px; }
    .annotation strong { font-weight: 500; color: #202124; }
    .actions { padding: 24px; text-align: center; background-color: #f8f9fa; }
    .button { background-color: #1a73e8; color: white; padding: 10px 24px; text-decoration: none; border-radius: 4px; font-weight: 500; display: inline-block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header {{ .Status }}">
      <h1>{{ if eq .Status "firing" }}ðŸ”´ Cáº£nh bÃ¡o Há»‡ thá»‘ng{{ else }}âœ… Cáº£nh bÃ¡o Ä‘Ã£ Ä‘Æ°á»£c giáº£i quyáº¿t{{ end }}</h1>
    </div>
    <div class="content">
      {{/* Title: prefer CommonAnnotations.summary, else first alert's summary, else fallback */}}
      <h2>
        {{ if .CommonAnnotations.summary }}
          {{ .CommonAnnotations.summary }}
        {{ else if gt (len .Alerts) 0 }}
          {{ with index .Alerts 0 }}
            {{ if .Annotations.summary }}{{ .Annotations.summary }}{{ else }}No summary{{ end }}
          {{ end }}
        {{ else }}
          No summary
        {{ end }}
      </h2>

      {{ if gt (len .Alerts) 0 }}
        {{ range .Alerts }}
        <div class="alert-item">
          <div>
            <span class="label"><strong>alert:</strong> {{ .Labels.alertname }}</span>
            {{ with .Labels.severity }}<span class="label severity-{{ . }}"><strong>severity:</strong> {{ . }}</span>{{ end }}
            {{ with .Labels.instance }}<span class="label"><strong>instance:</strong> {{ . }}</span>{{ end }}
            {{ with .Labels.job }}<span class="label"><strong>job:</strong> {{ . }}</span>{{ end }}
          </div>
          <div class="annotation">
            <strong>Chi tiáº¿t:</strong>
            {{ if .Annotations.description }}
              {{ .Annotations.description }}
            {{ else if .Annotations.summary }}
              {{ .Annotations.summary }}
            {{ else }}
              (No details supplied)
            {{ end }}
          </div>
          {{/* Optional: show start time if exists */}}
          {{ with .StartsAt }}
            <div style="margin-top: 8px; font-size: 12px; color: #5f6368;">
              <em>Started at: {{ . }}</em>
            </div>
          {{ end }}
        </div>
        {{ end }}
      {{ else }}
        <div class="alert-item">
          <div class="annotation">
            No alerts in this notification.
          </div>
        </div>
      {{ end }}

    </div>
    <div class="actions">
      <a href="{{ .ExternalURL }}" class="button" target="_blank">Xem trÃªn Alertmanager</a>
    </div>
  </div>
</body>
</html>
{{ end }}


{{ define "google.email.subject" }}
{{/* Subject: [STATUS(:countIfFiring)] summary-or-first-alert */}}
[{{ .Status | toUpper }}{{ if gt (len .Alerts.Firing) 0 }}:{{ len .Alerts.Firing }}{{ end }}] {{ if .CommonAnnotations.summary }}{{ .CommonAnnotations.summary }}{{ else if gt (len .Alerts) 0 }}{{ (index .Alerts 0).Annotations.summary }}{{ else }}No summary{{ end }}
{{ end }}
